<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Since Scripts</title>
  <meta name="description" content="Search, browse and discover handy scripts from this repo" />
  <style>
    :root{
      --accent:#2563eb; /* blue */
      --accent-600:#1d4ed8;
      --text:#0f172a;
      --muted:#50606a;
      --border:#e6e9ec;
      --bg:#ffffff;
      --card:#ffffff;
      --dot:#cfd8dd;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color:var(--text); background:var(--bg);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }

    .hero{
      position:relative; text-align:center; padding:48px 20px; width:100%; max-width:920px; margin:28px auto 0; isolation:isolate;
      display:block;
    }
    /* dotted background with center->edge fade */
    .hero::before{
      content:""; position:absolute; left:50%; top:0; transform:translateX(-50%);
      width:120%; height:160%;
      z-index:-1;
      background-image:
        radial-gradient(circle at center, rgba(110,118,125,0.95) 2px, transparent 2px);
      background-size:16px 16px;
      opacity:0.6;
      pointer-events:none;
      /* mask to fade dots toward edges */
      -webkit-mask-image: radial-gradient(circle at center, rgba(0,0,0,1) 0%, rgba(0,0,0,0.7) 45%, rgba(0,0,0,0) 85%);
      mask-image: radial-gradient(circle at center, rgba(0,0,0,1) 0%, rgba(0,0,0,0.7) 45%, rgba(0,0,0,0) 85%);
    }
    .hero::after{
      content:""; position:absolute; inset:0; z-index:-2; background:transparent; pointer-events:none;
    }

    h1{font-size:48px; line-height:1.08; margin:0 0 12px; font-weight:800; letter-spacing:-.02em}
    .sub{max-width:760px; margin:0 auto; color:var(--muted); font-size:18px; line-height:1.6}

    .search-wrap{margin-top:26px}
    .search{
      display:flex; align-items:center; gap:0; width:100%; max-width:680px; margin:0 auto; background:#fff;
      border:1px solid var(--border); border-radius:12px; box-shadow:0 6px 18px rgba(4,6,15,.04);
      overflow:hidden;
    }
    .icon{padding:0 10px 0 14px; color:#a8b3b9; display:flex; align-items:center}
    .search input{
      flex:1; height:52px; border:0; outline:none; font-size:16px; color:var(--text);
      background:#fff; padding:0 12px;
    }
    .search button{
      height:52px; padding:0 18px; border:0; color:#fff; background:var(--accent); font-weight:700; cursor:pointer;
      transition:background .15s ease; border-left:1px solid var(--border);
    }
    .search button:hover{background:var(--accent-600)}

    .meta{margin-top:12px; color:var(--muted); font-size:14px}
    .badge{display:inline-block; background:#f1f5f9; color:var(--accent-600); padding:6px 10px; border-radius:999px; font-size:12px; font-weight:700; margin-right:8px}

    .container{width:100%; max-width:980px; margin:18px auto 48px; padding:0 16px}
    /* single-column flow like original layout */
    .results{margin-top:18px; display:flex; flex-direction:column; gap:14px}

    .card{
      background:var(--card); border:1px solid var(--border); border-radius:12px; padding:16px;
      box-shadow:0 1px 2px rgba(4,6,15,.04); display:flex; flex-direction:column; gap:10px;
    }
    .card h3{margin:0 0 4px; font-size:18px}
    .card p{margin:0; color:var(--muted); font-size:14px}

    /* copy command area */
    .copy-box{background:#f8fafb; border:1px solid #e6eef2; border-radius:8px; padding:10px 12px; display:flex; align-items:center; gap:10px}
    .cmd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Segoe UI Mono", monospace; font-size:13px; color:#0b1720; white-space:pre-wrap; word-break:break-all; flex:1}
    .copy-btn{background:var(--accent); color:#fff; border:0; padding:8px 10px; border-radius:8px; cursor:pointer; font-weight:700}
    .copy-btn:active{transform:translateY(1px)}

    .card-footer{display:flex; gap:12px; font-size:13px; color:var(--muted); align-items:center; justify-content:space-between; flex-wrap:wrap}
    .meta-left{display:flex; gap:10px; align-items:center}
    .meta-right{color:#8aa8b2; font-size:13px}

    .empty{margin:24px 0; text-align:center; color:var(--muted)}

    @media (max-width:680px){ h1{font-size:36px} .sub{font-size:16px} .copy-btn{padding:8px 10px} }
  </style>
</head>
<body>
  <header class="hero">
    <h1>Search available scripts</h1>
    <p class="sub">Quickly find scripts in this repository. Search by name or description — no extra setup required.</p>

    <div class="search-wrap">
      <form id="searchForm" class="search" role="search">
        <span class="icon" aria-hidden="true">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
        </span>
        <input id="q" name="q" type="search" placeholder="Search for a script name or description" autocomplete="off" />
        <button type="submit">Search</button>
      </form>
      <div class="meta"><span class="badge">Info</span><span id="metaText">Loading…</span></div>
    </div>

  </header>

  <main class="container">
    <section id="results" class="results" aria-live="polite"></section>
    <div id="empty" class="empty" style="display:none">No matching scripts. Try another keyword.</div>
  </main>

  <script>
  (function(){
    const resultsEl = document.getElementById('results');
    const emptyEl = document.getElementById('empty');
    const metaEl = document.getElementById('metaText');
    const qInput = document.getElementById('q');
    const form = document.getElementById('searchForm');
    let all = [];

    function readQuery(){
      const u = new URL(window.location);
      return (u.searchParams.get('q')||'').trim();
    }
    function writeQuery(q){
      const u = new URL(window.location);
      if(q) u.searchParams.set('q', q); else u.searchParams.delete('q');
      history.replaceState(null, '', u);
    }

    function escapeHTML(str){
      return (str+"").replace(/[&<>\"']/g, s=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[s]));
    }

    function formatDate(d){
      try{
        const dt = new Date(d);
        if(isNaN(dt)) return d||'';
        return dt.toLocaleDateString();
      }catch(e){return d||''}
    }

    function buildCommand(s){
      // Prefer explicit raw/url fields if provided, else guess a raw install.sh in the dir
      const baseRaw = s.raw || s.url || (s.dir ? `https://raw.githubusercontent.com/wangsyiiz/since-scripts/main/${encodeURIComponent(s.dir)}/install.sh` : '');
      if(!baseRaw) return '';
      const curl = `curl -sSL ${baseRaw} | bash`;
      const wget = `wget -qO- ${baseRaw} | bash`;
      return curl + '\n' + wget;
    }

    function render(list){
      resultsEl.innerHTML = '';
      if(!list || list.length===0){
        emptyEl.style.display='block';
        return;
      }
      emptyEl.style.display='none';
      const frag = document.createDocumentFragment();
      list.forEach(s=>{
        const a = document.createElement('article');
        a.className = 'card';

        const title = escapeHTML(s.name||'Untitled');
        const desc = escapeHTML(s.description||'');
        const cmdText = buildCommand(s);
        const footerLeft = [];
        if(s.version) footerLeft.push(`v${escapeHTML(s.version)}`);
        if(s.updated) footerLeft.push(formatDate(s.updated));
        const footerRight = s.author ? escapeHTML(s.author) : '';

        a.innerHTML = `\n          <div>\n            <h3>${title}</h3>\n            <p>${desc}</p>\n          </div>\n        `;

        if(cmdText){
          const box = document.createElement('div');
          box.className = 'copy-box';
          const pre = document.createElement('div');
          pre.className = 'cmd';
          pre.textContent = cmdText;
          const btn = document.createElement('button');
          btn.className = 'copy-btn';
          btn.type = 'button';
          btn.textContent = 'Copy';
          btn.addEventListener('click', async ()=>{
            try{
              await navigator.clipboard.writeText(pre.textContent);
              btn.textContent = 'Copied!';
              setTimeout(()=>btn.textContent='Copy',1500);
            }catch(e){
              console.error('copy failed', e);
              // fallback
              const ta = document.createElement('textarea'); ta.value = pre.textContent;
              document.body.appendChild(ta); ta.select(); try{ document.execCommand('copy'); btn.textContent='Copied!'; }catch(e2){ alert('Copy failed.'); }
              document.body.removeChild(ta);
              setTimeout(()=>btn.textContent='Copy',1500);
            }
          });
          box.appendChild(pre);
          box.appendChild(btn);
          a.appendChild(box);
        }

        const footer = document.createElement('div');
        footer.className = 'card-footer';
        const left = document.createElement('div'); left.className='meta-left';
        const right = document.createElement('div'); right.className='meta-right';
        left.textContent = footerLeft.join(' · ');
        right.textContent = footerRight;
        footer.appendChild(left);
        footer.appendChild(right);
        a.appendChild(footer);

        frag.appendChild(a);
      });
      resultsEl.appendChild(frag);
    }

    function search(q){
      const term = (q||'').toLowerCase();
      const list = term ? all.filter(s =>
        (s.name && s.name.toLowerCase().includes(term)) ||
        (s.description && s.description.toLowerCase().includes(term)) ||
        (s.dir && s.dir.toLowerCase().includes(term))
      ) : all;
      render(list);
    }

    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      const q = qInput.value.trim();
      writeQuery(q);
      search(q);
    });

    // Robust scripts.json loading: try local, then raw GitHub, and show helpful meta text
    (async function(){
      const local = 'scripts.json';
      const raw = 'https://raw.githubusercontent.com/wangsyiiz/since-scripts/main/scripts.json';

      async function fetchJson(url){
        const r = await fetch(url, { cache: 'no-store' });
        if(!r.ok) throw new Error(`HTTP ${r.status}`);
        const txt = await r.text();
        try{
          const parsed = JSON.parse(txt);
          if(!Array.isArray(parsed)) throw new Error('scripts.json must be an array');
          return parsed;
        }catch(e){
          console.error('Failed to parse JSON from', url, e);
          throw e;
        }
      }

      try{
        try{
          const ts = Math.floor(Date.now()/60000); // minute resolution
          all = await fetchJson(`${local}?v=${ts}`);
        }catch(localErr){
          console.warn('Local scripts.json failed, falling back to raw GitHub', localErr);
          all = await fetchJson(raw);
        }
        metaEl.textContent = `${all.length} scripts available`;
        const q0 = readQuery();
        if(q0) qInput.value = q0;
        search(q0);
      }catch(err){
        all = [];
        metaEl.textContent = 'No scripts available';
        console.error('Could not load scripts.json from either source:', err);
      }
    })();
  })();
  </script>
</body>
</html>