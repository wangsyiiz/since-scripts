<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Since Scripts</title>
  <meta name="description" content="Search, browse and discover handy scripts from this repo" />
  <!-- Inter + Noto Sans SC -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --accent:#2563eb; /* blue */
      --accent-600:#1d4ed8;
      --text:#0f172a;
      --muted:#50606a;
      --border:#e6e9ec;
      --bg:#ffffff;
      --card:#ffffff; /* fully opaque card background */
      --dot-color: 15,23,42; /* rgb for dots (will be used with alpha variable) */
      --dot-size: 0.5px; /* smaller dot radius */
      --dot-alpha: 0.04; /* lighter dots */
      --dot-spacing: 12px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: "Inter", "Noto Sans SC", ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color:var(--text); background:var(--bg);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      position:relative;
      z-index:0;
    }

    /* dotted background layer placed behind everything */
    body::before{
      content:""; position:fixed; inset:0; z-index:0; pointer-events:none;
      background-image:
        radial-gradient(circle, rgba(var(--dot-color), var(--dot-alpha)) var(--dot-size), transparent calc(var(--dot-size) + 1px));
      background-size: var(--dot-spacing) var(--dot-spacing);
      background-position: center;
      mix-blend-mode: normal;
      opacity:1;
    }

    .hero{
      position:relative; text-align:center; padding:48px 20px; width:100%; max-width:920px; margin:28px auto 0; isolation:isolate;
      display:block; z-index:1; /* ensure content is above dots */
    }

    h1{font-size:48px; line-height:1.08; margin:0 0 12px; font-weight:800; letter-spacing:-.02em}
    .sub{max-width:760px; margin:0 auto; color:var(--muted); font-size:18px; line-height:1.6}

    .search-wrap{margin-top:26px}
    .search{
      display:flex; align-items:center; gap:0; width:100%; max-width:680px; margin:0 auto; background:#fff;
      border:1px solid var(--border); border-radius:12px; box-shadow:0 6px 18px rgba(4,6,15,.04);
      overflow:hidden; z-index:1; position:relative;
    }

    .icon{padding:0 10px 0 14px; color:#a8b3b9; display:flex; align-items:center}
    .search input{
      flex:1; height:52px; border:0; outline:none; font-size:16px; color:var(--text);
      background:#fff; padding:0 12px;
    }
    .search button{
      height:52px; padding:0 18px; border:0; color:#fff; background:var(--accent); font-weight:700; cursor:pointer;
      transition:background .15s ease; border-left:1px solid var(--border);
    }
    .search button:hover{background:var(--accent-600)}

    .meta{margin-top:12px; color:var(--muted); font-size:14px}
    .badge{display:inline-block; background:#f1f5f9; color:var(--accent-600); padding:6px 10px; border-radius:999px; font-size:12px; font-weight:700; margin-right:8px}

    .container{width:100%; max-width:980px; margin:18px auto 48px; padding:0 16px; z-index:1; position:relative}
    /* single-column flow like original layout */
    .results{margin-top:18px; display:flex; flex-direction:column; gap:14px}

    .card{
      background:var(--card); border:1px solid var(--border); border-radius:12px; padding:16px;
      box-shadow:0 1px 2px rgba(4,6,15,.04); display:flex; flex-direction:column; gap:10px; position:relative; z-index:2;
    }
    .card h3{margin:0 0 4px; font-size:18px}
    .card p{margin:0; color:var(--muted); font-size:14px}

    /* copy command area */
    .copy-box{background:#f8fafb; border:1px solid #e6eef2; border-radius:8px; padding:10px 12px; display:flex; align-items:center; gap:10px}
    .cmd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Segoe UI Mono", monospace; font-size:13px; color:#0b1720; white-space:pre-wrap; word-break:break-all; flex:1}
    .copy-btn{background:var(--accent); color:#fff; border:0; padding:8px 10px; border-radius:8px; cursor:pointer; font-weight:700}
    .copy-btn:active{transform:translateY(1px)}

    .card-footer{display:flex; gap:12px; font-size:13px; color:var(--muted); align-items:center; justify-content:space-between; flex-wrap:wrap}
    .meta-left{display:flex; gap:10px; align-items:center}
    .meta-right{color:#8aa8b2; font-size:13px}

    .empty{margin:24px 0; text-align:center; color:var(--muted)}

    .hl{ color:var(--accent); font-weight:700 }

    @media (max-width:680px){ h1{font-size:36px} .sub{font-size:16px} .copy-btn{padding:8px 10px} }
  </style>
</head>
<body>
  <header class="hero">
    <h1>Search available scripts</h1>
    <p class="sub">Quickly find scripts in this repository. Search by name or description — no extra setup required.</p>

    <div class="search-wrap">
      <form id="searchForm" class="search" role="search">
        <span class="icon" aria-hidden="true">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
        </span>
        <input id="q" name="q" type="search" placeholder="Search for a script name or description" autocomplete="off" />
        <button type="submit">Search</button>
      </form>
      <div class="meta"><span class="badge">Info</span><span id="metaText">Loading…</span></div>
    </div>

  </header>

  <main class="container">
    <section id="results" class="results" aria-live="polite"></section>
    <div id="empty" class="empty" style="display:none">No matching scripts. Try another keyword.</div>
  </main>

  <script>
  (function(){
    const resultsEl = document.getElementById('results');
    const emptyEl = document.getElementById('empty');
    const metaEl = document.getElementById('metaText');
    const qInput = document.getElementById('q');
    const form = document.getElementById('searchForm');
    let all = [];

    function readQuery(){
      const u = new URL(window.location);
      return (u.searchParams.get('q')||'').trim();
    }
    function writeQuery(q){
      const u = new URL(window.location);
      if(q) u.searchParams.set('q', q); else u.searchParams.delete('q');
      history.replaceState(null, '', u);
    }

    function escapeHTML(str){
      return (str+"").replace(/[&<>\"']/g, s=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[s]));
    }
    function escapeRegExp(s){ return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); }

    function formatDate(d){
      try{
        const dt = new Date(d);
        if(isNaN(dt)) return d||'';
        return dt.toLocaleDateString();
      }catch(e){return d||''}
    }

    function buildCommandObj(s){
      const baseRaw = s.raw || s.url || (s.dir ? `https://raw.githubusercontent.com/wangsyiiz/since-scripts/main/${encodeURIComponent(s.dir)}/install.sh` : '');
      if(!baseRaw) return null;
      return { curl: `curl -sSL ${baseRaw} | bash`, wget: `wget -qO- ${baseRaw} | bash` };
    }

    function highlightHTML(text, term){
      if(!term) return escapeHTML(text);
      const tokens = (term||'').split(/\s+/).filter(Boolean).map(t=>escapeRegExp(t));
      if(tokens.length===0) return escapeHTML(text);
      const re = new RegExp('(' + tokens.join('|') + ')', 'ig');
      return escapeHTML(text).replace(re, '<span class="hl">$1</span>');
    }

    function render(list, term){
      resultsEl.innerHTML = '';
      if(!list || list.length===0){
        emptyEl.style.display='block';
        return;
      }
      emptyEl.style.display='none';
      const frag = document.createDocumentFragment();
      const q = term || '';
      list.forEach(s=>{
        const a = document.createElement('article');
        a.className = 'card';

        const titleHTML = highlightHTML(s.name||'Untitled', q);
        const descHTML = highlightHTML(s.description||'', q);

        a.innerHTML = `\n          <div>\n            <h3>${titleHTML}</h3>\n            <p>${descHTML}</p>\n          </div>\n        `;

        const cmdObj = buildCommandObj(s);
        if(cmdObj){
          // curl box
          const curlBox = document.createElement('div');
          curlBox.className = 'copy-box';
          const curlCmd = document.createElement('div'); curlCmd.className='cmd'; curlCmd.textContent = cmdObj.curl;
          const curlBtn = document.createElement('button'); curlBtn.className='copy-btn'; curlBtn.type='button'; curlBtn.textContent='Copy curl';
          curlBtn.addEventListener('click', async ()=>{
            try{ await navigator.clipboard.writeText(curlCmd.textContent); curlBtn.textContent='Copied!'; setTimeout(()=>curlBtn.textContent='Copy curl',1500); }
            catch(e){ fallbackCopy(curlCmd.textContent, curlBtn, 'Copy curl'); }
          });
          curlBox.appendChild(curlCmd); curlBox.appendChild(curlBtn);
          a.appendChild(curlBox);

          // wget box
          const wgetBox = document.createElement('div');
          wgetBox.className = 'copy-box';
          const wgetCmd = document.createElement('div'); wgetCmd.className='cmd'; wgetCmd.textContent = cmdObj.wget;
          const wgetBtn = document.createElement('button'); wgetBtn.className='copy-btn'; wgetBtn.type='button'; wgetBtn.textContent='Copy wget';
          wgetBtn.addEventListener('click', async ()=>{
            try{ await navigator.clipboard.writeText(wgetCmd.textContent); wgetBtn.textContent='Copied!'; setTimeout(()=>wgetBtn.textContent='Copy wget',1500); }
            catch(e){ fallbackCopy(wgetCmd.textContent, wgetBtn, 'Copy wget'); }
          });
          wgetBox.appendChild(wgetCmd); wgetBox.appendChild(wgetBtn);
          a.appendChild(wgetBox);
        }

        const footer = document.createElement('div');
        footer.className = 'card-footer';
        const left = document.createElement('div'); left.className='meta-left';
        const right = document.createElement('div'); right.className='meta-right';
        const footerLeft = [];
        if(s.version) footerLeft.push(`v${s.version}`);
        if(s.updated) footerLeft.push(formatDate(s.updated));
        left.textContent = footerLeft.join(' · ');
        right.textContent = s.author || '';
        footer.appendChild(left);
        footer.appendChild(right);
        a.appendChild(footer);

        frag.appendChild(a);
      });
      resultsEl.appendChild(frag);
    }

    function fallbackCopy(text, btn, defaultLabel){
      try{
        const ta = document.createElement('textarea'); ta.value = text; ta.style.position='fixed'; ta.style.left='-9999px'; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
        btn.textContent='Copied!'; setTimeout(()=>btn.textContent=defaultLabel,1500);
      }catch(e){ alert('Copy failed.'); }
    }

    function search(q){
      const term = (q||'').toLowerCase();
      const scope = 'all'; // search across all fields; search scope selector removed
      const list = term ? all.filter(s => {
        if(scope==='all'){
          return (s.name && s.name.toLowerCase().includes(term)) ||
                 (s.description && s.description.toLowerCase().includes(term)) ||
                 (s.dir && s.dir.toLowerCase().includes(term));
        }
        return false;
      }) : all;
      render(list, q);
      metaEl.textContent = `${list.length} scripts shown`;
    }

    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      const q = qInput.value.trim();
      writeQuery(q);
      search(q);
    });

    function debounce(fn, wait){ let t; return function(...args){ clearTimeout(t); t = setTimeout(()=>fn.apply(this,args), wait); }; }

    const debouncedInput = debounce(()=>{
      const q = qInput.value.trim();
      writeQuery(q);
      search(q);
    }, 300);

    qInput.addEventListener('input', debouncedInput);

    // Robust scripts.json loading: try local, then raw GitHub, and show helpful meta text
    (async function(){
      const local = 'scripts.json';
      const raw = 'https://raw.githubusercontent.com/wangsyiiz/since-scripts/main/scripts.json';

      async function fetchJson(url){
        const r = await fetch(url, { cache: 'no-store' });
        if(!r.ok) throw new Error(`HTTP ${r.status}`);
        const txt = await r.text();
        try{
          const parsed = JSON.parse(txt);
          if(!Array.isArray(parsed)) throw new Error('scripts.json must be an array');
          return parsed;
        }catch(e){
          console.error('Failed to parse JSON from', url, e);
          throw e;
        }
      }

      try{
        try{
          const ts = Math.floor(Date.now()/60000); // minute resolution
          all = await fetchJson(`${local}?v=${ts}`);
        }catch(localErr){
          console.warn('Local scripts.json failed, falling back to raw GitHub', localErr);
          all = await fetchJson(raw);
        }
        metaEl.textContent = `${all.length} scripts available`;
        const q0 = readQuery();
        if(q0) qInput.value = q0;
        search(q0);
      }catch(err){
        all = [];
        metaEl.textContent = 'No scripts available';
        console.error('Could not load scripts.json from either source:', err);
      }
    })();
  })();
  </script>
</body>
</html>